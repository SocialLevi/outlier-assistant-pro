<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outlier Help</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }
        .hidden {
            display: none;
        }
        .spinner {
            border-top-color: #14b8a6; /* Teal color */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="h-full text-gray-200 bg-gray-900">
    <!-- Anti-inspection script -->
    <script>
        // Disable right-click context menu
        document.addEventListener('contextmenu', event => event.preventDefault());

        // Disable keyboard shortcuts for developer tools
        document.addEventListener('keydown', function(event) {
            if (event.key === 'F12' || 
               (event.ctrlKey && event.shiftKey && (event.key === 'I' || event.key === 'i')) || 
               (event.ctrlKey && event.shiftKey && (event.key === 'J' || event.key === 'j')) || 
               (event.ctrlKey && (event.key === 'U' || event.key === 'u'))) {
                event.preventDefault();
            }
        });
    </script>
    
    <!-- Full screen background container for the login page -->
    <div id="auth-background-container" class="fixed inset-0 z-0 transition-opacity duration-1000 opacity-0">
        <div class="absolute inset-0 bg-black/70"></div> <!-- Darker overlay -->
        <img id="auth-bg-image" src="" alt="Dynamic background" class="w-full h-full object-cover">
    </div>

    <div id="app" class="relative z-10 flex items-center justify-center min-h-full p-4 sm:p-6 lg:p-8">

        <!-- Loading Spinner -->
        <div id="loading-spinner" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
            <div class="spinner h-16 w-16 border-4 border-gray-700 rounded-full"></div>
        </div>

        <!-- Auth Section -->
        <div id="auth-section" class="hidden w-full max-w-md space-y-8">
            <div class="relative z-10 text-center">
                <h2 class="text-4xl font-bold tracking-tight text-white">Welcome to Outlier Help</h2>
                <p class="mt-2 text-sm text-gray-400">
                    Sign in to access your dashboard
                </p>
            </div>
            <div class="bg-gray-900/40 backdrop-blur-xl border border-white/10 p-8 rounded-2xl shadow-2xl space-y-6 relative z-10">
                <!-- Auth Forms: Login / Signup Toggle -->
                <div id="login-form">
                     <input id="login-email" type="email" autocomplete="email" required class="block w-full rounded-md border-0 bg-white/5 p-3 text-white placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-teal-500 sm:text-sm transition-all duration-300" placeholder="Email address">
                     <div class="relative mt-4">
                        <input id="login-password" type="password" autocomplete="current-password" required class="block w-full rounded-md border-0 bg-white/5 p-3 pr-10 text-white placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-teal-500 sm:text-sm transition-all duration-300" placeholder="Password">
                        <button type="button" id="login-password-toggle" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-white">
                           <svg id="login-eye-icon" class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639l4.43-7.086a1.012 1.012 0 011.633 0l4.43 7.086a1.012 1.012 0 010 .639l-4.43 7.086a1.012 1.012 0 01-1.633 0l-4.43-7.086z" />
                              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                           </svg>
                           <svg id="login-eye-slash-icon" class="h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243L6.228 6.228" />
                           </svg>
                        </button>
                     </div>
                      <div class="text-right text-sm mt-2">
                        <a href="#" id="forgot-password-link" class="font-medium text-teal-400 hover:text-teal-300">Forgot password?</a>
                    </div>
                     <button id="login-button" class="mt-4 flex w-full justify-center rounded-md bg-teal-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-teal-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-teal-600 transition-all duration-300 transform hover:scale-105">Sign in</button>
                </div>
                 <div id="signup-form" class="hidden">
                     <input id="signup-email" type="email" autocomplete="email" required class="block w-full rounded-md border-0 bg-white/5 p-3 text-white placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-teal-500 sm:text-sm transition-all duration-300" placeholder="Email address">
                     <div class="relative mt-4">
                        <input id="signup-password" type="password" autocomplete="new-password" required class="block w-full rounded-md border-0 bg-white/5 p-3 pr-10 text-white placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-teal-500 sm:text-sm transition-all duration-300" placeholder="Password">
                         <button type="button" id="signup-password-toggle" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-white">
                           <svg id="signup-eye-icon" class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639l4.43-7.086a1.012 1.012 0 011.633 0l4.43 7.086a1.012 1.012 0 010 .639l-4.43 7.086a1.012 1.012 0 01-1.633 0l-4.43-7.086z" />
                              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                           </svg>
                           <svg id="signup-eye-slash-icon" class="h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243L6.228 6.228" />
                           </svg>
                        </button>
                     </div>
                     <button id="signup-button" class="mt-6 flex w-full justify-center rounded-md bg-teal-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-teal-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-teal-600 transition-all duration-300 transform hover:scale-105">Create Account</button>
                </div>

                 <div id="forgot-password-form" class="hidden">
                    <p class="text-center text-gray-300 mb-4">Enter your email to receive a password reset link.</p>
                     <input id="reset-email" type="email" autocomplete="email" required class="block w-full rounded-md border-0 bg-white/5 p-3 text-white placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-teal-500 sm:text-sm transition-all duration-300" placeholder="Email address">
                     <button id="send-reset-button" class="mt-6 flex w-full justify-center rounded-md bg-teal-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-teal-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-teal-600 transition-all duration-300 transform hover:scale-105">Send Reset Link</button>
                    <div class="text-center text-sm mt-4">
                        <a href="#" id="back-to-login-link" class="font-medium text-teal-400 hover:text-teal-300">Back to Sign In</a>
                    </div>
                </div>

                <div class="text-center text-sm">
                    <a href="#" id="toggle-auth" class="font-medium text-teal-400 hover:text-teal-300">Don't have an account? Sign up</a>
                </div>

                <div class="relative">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-700"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="bg-gray-900/40 px-2 text-gray-400">Or continue with</span>
                    </div>
                </div>

                <div>
                    <button id="google-signin-button" class="flex w-full items-center justify-center gap-3 rounded-md bg-white/95 px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-white focus-visible:ring-transparent transition-all duration-300 transform hover:scale-105">
                        <svg class="h-5 w-5" aria-hidden="true" viewBox="0 0 24 24">
                            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/>
                            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                            <path d="M1 1h22v22H1z" fill="none"/>
                        </svg>
                        <span>Continue with Google</span>
                    </button>
                </div>
            </div>
             <p id="auth-error" class="mt-2 text-center text-sm text-red-400"></p>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="hidden w-full h-full">
            <div class="flex flex-col h-full max-w-7xl mx-auto">
                <!-- Header -->
                <header class="bg-gray-800/80 backdrop-blur-sm border-b border-gray-700 rounded-b-lg sticky top-0 z-30">
                    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                        <div class="flex h-16 items-center justify-between">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                   <span class="text-xl font-bold text-white">Outlier Help</span>
                                </div>
                                <div class="hidden md:block">
                                    <div class="ml-10 flex items-baseline space-x-4">
                                        <a href="#about" class="nav-link bg-gray-900 text-white rounded-md px-3 py-2 text-sm font-medium">About Us</a>
                                        <a href="#menu" class="nav-link text-gray-300 hover:bg-gray-700 hover:text-white rounded-md px-3 py-2 text-sm font-medium">Menu</a>
                                        <a href="#projects" class="nav-link text-gray-300 hover:bg-gray-700 hover:text-white rounded-md px-3 py-2 text-sm font-medium">Projects</a>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <div class="hidden md:block">
                                    <div class="ml-4 flex items-center md:ml-6">
                                        <span id="user-email" class="text-gray-400 text-sm mr-4"></span>
                                        <button id="signout-button" class="rounded-full bg-gray-800 p-1 text-gray-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-800">
                                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="-mr-2 flex md:hidden">
                                     <!-- Mobile menu button -->
                                     <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center rounded-md bg-gray-800 p-2 text-gray-400 hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-800" aria-controls="mobile-menu" aria-expanded="false">
                                        <span class="sr-only">Open main menu</span>
                                        <svg id="hamburger-icon" class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                                        </svg>
                                        <svg id="close-icon" class="hidden h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                      </button>
                                </div>
                            </div>
                        </div>
                    </div>
                     <!-- Mobile menu, show/hide based on menu state. -->
                    <div class="md:hidden hidden" id="mobile-menu">
                        <div class="space-y-1 px-2 pb-3 pt-2 sm:px-3">
                            <a href="#about" class="mobile-nav-link block rounded-md px-3 py-2 text-base font-medium text-gray-300 hover:bg-gray-700 hover:text-white">About Us</a>
                            <a href="#menu" class="mobile-nav-link block rounded-md px-3 py-2 text-base font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Menu</a>
                            <a href="#projects" class="mobile-nav-link block rounded-md px-3 py-2 text-base font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Projects</a>
                        </div>
                        <div class="border-t border-gray-700 pb-3 pt-4">
                            <div class="flex items-center px-5">
                                <div class="ml-3">
                                    <div id="mobile-user-email" class="text-base font-medium leading-none text-white"></div>
                                </div>
                            </div>
                            <div class="mt-3 space-y-1 px-2">
                                <button id="mobile-signout-button" class="block w-full text-left rounded-md px-3 py-2 text-base font-medium text-gray-400 hover:bg-gray-700 hover:text-white">Sign out</button>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Main Content -->
                <main class="flex-grow py-8">
                    <div id="page-content" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                        <!-- Content will be injected here -->
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Page Content Templates -->
    <template id="about-template">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg">
            <h1 class="text-3xl font-bold tracking-tight text-white">About Outlier Help</h1>
            <p class="mt-4 text-gray-300 leading-relaxed">Outlier Help is a platform dedicated to connecting skilled individuals with unique and challenging projects. We believe in fostering a community of problem-solvers and innovators.</p>
            <p class="mt-2 text-gray-300 leading-relaxed">Our mission is to provide a space where talent can be tested, proven, and applied to meaningful work. By passing our evaluations, you demonstrate your readiness to tackle complex tasks and join an elite group of professionals.</p>
        </div>
    </template>

    <template id="menu-template">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg">
            <h1 class="text-3xl font-bold tracking-tight text-white">Menu</h1>
            <p class="mt-4 text-gray-300 leading-relaxed">Navigate through the platform using the links in the header. Here you can find information about us, explore the menu options, and access the project evaluation section.</p>
        </div>
    </template>

    <template id="projects-template">
        <div class="bg-gray-800 p-8 rounded-lg shadow-lg">
            <div id="evaluation-container">
                <div id="assessment-content">
                    <!-- Dynamic Assessment Content will be injected here -->
                </div>
                <div class="mt-6">
                    <button id="submit-evaluation-button" class="flex items-center justify-center rounded-md bg-teal-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-teal-500 disabled:bg-gray-500 disabled:cursor-not-allowed">
                        <span id="submit-btn-text">Submit Assessment</span>
                        <div id="submit-spinner" class="spinner h-5 w-5 border-2 ml-3 hidden"></div>
                    </button>
                </div>
                <p id="evaluation-result" class="mt-4 text-center text-sm font-medium"></p>
            </div>
            <div id="projects-list-container" class="hidden">
                 <h1 class="text-3xl font-bold tracking-tight text-white">Available Projects</h1>
                 <p class="mt-2 text-gray-400">Congratulations on passing the evaluation. Here are the projects available to you.</p>
                 <ul id="projects-list" class="mt-6 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
                    <!-- Project items will be injected here -->
                 </ul>
            </div>
        </div>
    </template>

    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signInWithPopup,
            GoogleAuthProvider,
            signOut,
            signInWithCustomToken,
            signInAnonymously,
            sendPasswordResetEmail
        } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
        import {
            getFirestore,
            doc,
            getDoc,
            setDoc,
        } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

        // --- Firebase Configuration ---
        const VERCEL_FALLBACK_CONFIG = {
            apiKey: "AIzaSyCBj0OcUbYYMPlHNZoyokIpKhlKpWUkU_Q",
            authDomain: "outlier-420a8.firebaseapp.com",
            projectId: "outlier-420a8",
            storageBucket: "outlier-420a8.firebasestorage.app",
            messagingSenderId: "449895404853",
            appId: "1:449895404853:web:9bb10a3add516a1620287c",
            measurementId: "G-TYXVKEEQRF"
        };

        const firebaseConfigString = typeof __firebase_config !== 'undefined' 
            ? __firebase_config 
            : JSON.stringify(VERCEL_FALLBACK_CONFIG);

        const firebaseConfig = JSON.parse(firebaseConfigString);

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-outlier-help';

        // --- Initialize Firebase ---
        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch(error) {
            console.error("Firebase initialization failed:", error);
            document.getElementById('loading-spinner').classList.add('hidden');
            const authSection = document.getElementById('auth-section');
            if (authSection) {
                authSection.classList.remove('hidden');
                const authError = document.getElementById('auth-error');
                if (authError) {
                    authError.textContent = "Failed to connect to services. Please check configuration.";
                }
            }
        }
        

        // --- DOM Elements ---
        const loadingSpinner = document.getElementById('loading-spinner');
        const authSection = document.getElementById('auth-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const authError = document.getElementById('auth-error');
        const toggleAuthLink = document.getElementById('toggle-auth');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const forgotPasswordForm = document.getElementById('forgot-password-form');

        // --- App State ---
        let currentUser = null;
        let isSignup = false;
        let isBgImageGenerated = false;
        let isDashboardInitialized = false;

        // --- Setup Functions ---
        function setAuthError(message) {
            if (authError) {
                authError.textContent = message;
                authError.classList.add('text-red-400');
                authError.classList.remove('text-green-400');
            }
        }

        function setAuthSuccess(message) {
            if (authError) {
                authError.textContent = message;
                authError.classList.remove('text-red-400');
                authError.classList.add('text-green-400');
            }
        }

        function setupPasswordToggle(inputId, toggleButtonId, eyeIconId, eyeSlashIconId) {
            const passwordInput = document.getElementById(inputId);
            const toggleButton = document.getElementById(toggleButtonId);
            const eyeIcon = document.getElementById(eyeIconId);
            const eyeSlashIcon = document.getElementById(eyeSlashIconId);

            if (!toggleButton || !passwordInput) return;

            toggleButton.addEventListener('click', () => {
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    eyeIcon.classList.add('hidden');
                    eyeSlashIcon.classList.remove('hidden');
                } else {
                    passwordInput.type = 'password';
                    eyeIcon.classList.remove('hidden');
                    eyeSlashIcon.classList.add('hidden');
                }
            });
        }

        // --- Authentication Logic ---
        async function initAuth() {
            if (!auth) return; // Don't run if Firebase failed to init
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Initial authentication failed:", error);
                setAuthError("Could not connect to services. Please refresh.");
            }
        }

        function setupAuthListeners() {
            onAuthStateChanged(auth, async (user) => {
                const authBg = document.getElementById('auth-background-container');
                if (user && user.email) {
                    currentUser = user;
                    authSection.classList.add('hidden');
                    dashboardSection.classList.remove('hidden');
                    authBg.classList.add('opacity-0');
                    document.getElementById('user-email').textContent = user.email;
                    document.getElementById('mobile-user-email').textContent = user.email;
                    if (!isDashboardInitialized) {
                        await main();
                        isDashboardInitialized = true;
                    }
                } else {
                    currentUser = null;
                    isDashboardInitialized = false;
                    authSection.classList.remove('hidden');
                    dashboardSection.classList.add('hidden');
                    authBg.classList.remove('opacity-0');
                    if (!isBgImageGenerated) {
                        generateBackgroundImage();
                        isBgImageGenerated = true;
                    }
                    setupPasswordToggle('login-password', 'login-password-toggle', 'login-eye-icon', 'login-eye-slash-icon');
                    setupPasswordToggle('signup-password', 'signup-password-toggle', 'signup-eye-icon', 'signup-eye-slash-icon');
                }
                loadingSpinner.classList.add('hidden');
            });
        }
        
        // --- Auth Form UI Logic ---
        if (toggleAuthLink) {
            toggleAuthLink.addEventListener('click', (e) => {
                e.preventDefault();
                isSignup = !isSignup;
                if (isSignup) {
                    showForm(signupForm);
                    toggleAuthLink.textContent = 'Already have an account? Sign in';
                } else {
                    showForm(loginForm);
                    toggleAuthLink.textContent = "Don't have an account? Sign up";
                }
            });
        }

        if (document.getElementById('forgot-password-link')) {
             document.getElementById('forgot-password-link').addEventListener('click', (e) => {
                e.preventDefault();
                showForm(forgotPasswordForm);
                if (toggleAuthLink) toggleAuthLink.classList.add('hidden');
            });
        }

       if(document.getElementById('back-to-login-link')) {
            document.getElementById('back-to-login-link').addEventListener('click', (e) => {
                e.preventDefault();
                isSignup = false;
                showForm(loginForm);
                if (toggleAuthLink) {
                    toggleAuthLink.classList.remove('hidden');
                    toggleAuthLink.textContent = "Don't have an account? Sign up";
                }
            });
       }
        
        function showForm(formToShow) {
            if (loginForm) loginForm.classList.add('hidden');
            if (signupForm) signupForm.classList.add('hidden');
            if (forgotPasswordForm) forgotPasswordForm.classList.add('hidden');
            if (formToShow) formToShow.classList.remove('hidden');
            setAuthError('');
        }
        
        // --- Auth Action Logic ---
        if(document.getElementById('login-button')){
            document.getElementById('login-button').addEventListener('click', async () => {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                setAuthError('');
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    setAuthError(error.message);
                }
            });
        }

        if(document.getElementById('signup-button')){
            document.getElementById('signup-button').addEventListener('click', async () => {
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                setAuthError('');
                try {
                    await createUserWithEmailAndPassword(auth, email, password);
                } catch (error) {
                    setAuthError(error.message);
                }
            });
        }

        if(document.getElementById('send-reset-button')){
            document.getElementById('send-reset-button').addEventListener('click', async () => {
                const email = document.getElementById('reset-email').value;
                setAuthError('');
                try {
                    await sendPasswordResetEmail(auth, email);
                    setAuthSuccess('Password reset email sent! Check your inbox.');
                } catch (error) {
                    setAuthError(error.message);
                }
            });
        }

        if(document.getElementById('google-signin-button')){
            document.getElementById('google-signin-button').addEventListener('click', async () => {
                const provider = new GoogleAuthProvider();
                setAuthError('');
                try {
                    await signInWithPopup(auth, provider);
                } catch (error) {
                    setAuthError(error.message);
                }
            });
        }
        
        function handleSignOut() {
             signOut(auth);
        }

        if(document.getElementById('signout-button')) document.getElementById('signout-button').addEventListener('click', handleSignOut);
        if(document.getElementById('mobile-signout-button')) document.getElementById('mobile-signout-button').addEventListener('click', handleSignOut);
        
        
        // --- Dashboard Logic ---
        async function main() {
            const navLinks = document.querySelectorAll('.nav-link');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            
            if(mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    const mobileMenu = document.getElementById('mobile-menu');
                    const hamburgerIcon = document.getElementById('hamburger-icon');
                    const closeIcon = document.getElementById('close-icon');
                    const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
                    mobileMenuButton.setAttribute('aria-expanded', !isExpanded);
                    mobileMenu.classList.toggle('hidden');
                    hamburgerIcon.classList.toggle('hidden');
                    closeIcon.classList.toggle('hidden');
                });
            }
            
            document.querySelectorAll('.mobile-nav-link').forEach(link => {
                link.addEventListener('click', () => {
                    const mobileMenu = document.getElementById('mobile-menu');
                    const mobileMenuButton = document.getElementById('mobile-menu-button');
                    const hamburgerIcon = document.getElementById('hamburger-icon');
                    const closeIcon = document.getElementById('close-icon');

                    if(mobileMenu) mobileMenu.classList.add('hidden');
                    if(hamburgerIcon) hamburgerIcon.classList.remove('hidden');
                    if(closeIcon) closeIcon.classList.add('hidden');
                    if(mobileMenuButton) mobileMenuButton.setAttribute('aria-expanded', 'false');
                });
            });

            function updateActiveLink(hash) {
                navLinks.forEach(link => {
                    if (link.hash === hash) {
                        link.classList.add('bg-gray-900', 'text-white');
                        link.classList.remove('text-gray-300', 'hover:bg-gray-700');
                    } else {
                        link.classList.remove('bg-gray-900', 'text-white');
                        link.classList.add('text-gray-300', 'hover:bg-gray-700');
                    }
                });
            }
            
            async function loadContent() {
                try {
                    const hash = window.location.hash || '#about';
                    updateActiveLink(hash);
                    let templateId;
                    switch(hash) {
                        case '#menu': templateId = 'menu-template'; break;
                        case '#projects': templateId = 'projects-template'; break;
                        case '#about': default: templateId = 'about-template'; break;
                    }
                    const template = document.getElementById(templateId);
                    const pageContent = document.getElementById('page-content');
                    if(template && pageContent) {
                        pageContent.innerHTML = template.innerHTML;
                    }

                    if (hash === '#projects') {
                        await setupProjectsPage();
                    }
                } catch (error) {
                    console.error("Error loading page content:", error);
                    const pageContent = document.getElementById('page-content');
                    if(pageContent) {
                        pageContent.innerHTML = `<div class="text-center text-red-400">Failed to load content. Please try again.</div>`;
                    }
                }
            }
            
            window.addEventListener('hashchange', loadContent);
            await loadContent(); // Initial load
        }
        
        // --- Projects Page Logic ---
        const assessments = [
            {
                prompt: "Critically assess John Searle's 'Chinese Room' argument against Strong AI in the context of modern Large Language Models (LLMs) like GPT-4. Does the argument retain its validity?",
                responseA: "Searle's argument is outdated. The sheer scale and emergent capabilities of models like GPT-4 demonstrate a form of understanding that transcends simple symbol manipulation. Their ability to generate coherent, context-aware text suggests they are not just syntax engines but have achieved a level of semantic comprehension.",
                responseB: "The 'Chinese Room' argument remains fundamentally valid. LLMs, despite their complexity, are sophisticated statistical pattern matchers operating on syntax, not semantics. They manipulate symbols based on probabilistic relationships learned from data, without genuine consciousness or intentionality, making them a more advanced, but functionally equivalent, version of the room.",
                expertHint: "A PhD-level analysis must recognize that LLMs operate on statistical patterns without true semantic understanding, which supports Searle's core claim. Therefore, Response B is philosophically more sound. A strong justification for B would highlight the distinction between functional simulation and genuine intentionality. A justification for A would be incorrect as it conflates complex pattern matching with semantic comprehension."
            },
            {
                prompt: "Explain the core paradox of black hole information loss and summarize the leading proposed solution derived from the AdS/CFT correspondence.",
                responseA: "The paradox is that black holes seem to destroy information, which quantum mechanics forbids. Hawking radiation, the stuff that leaks out, is random and contains no information. The solution from string theory is that the information might be stored in some other dimension we can't see.",
                responseB: "The paradox arises from the conflict between general relativity's 'no-hair theorem' and the principle of unitarity in quantum mechanics. Unitarity demands that information is conserved, but Hawking radiation appears thermal and information-free. The AdS/CFT correspondence suggests a holographic principle, where the information of a black hole isn't lost but is holographically encoded on its event horizon, a lower-dimensional boundary, thus preserving unitarity.",
                expertHint: "Response B is vastly superior as it uses precise terminology (unitarity, no-hair theorem, holographic principle) and correctly identifies the central conflict and the mechanism of the proposed solution. Response A is a pop-science oversimplification and is incorrect for this level of analysis."
            },
            {
                prompt: "Analyze the use of intertextuality in T.S. Eliot's 'The Waste Land' as a reflection of post-war modernist fragmentation.",
                responseA: "The poem uses a lot of quotes and references to other books. This shows that European culture was broken and in pieces after World War I, and Eliot is showing all the broken parts.",
                responseB: "Eliot employs a mosaic of literary and cultural allusions, not as mere ornamentation, but to construct a fragmented consciousness reflecting a collapsed cultural narrative. By juxtaposing classical myths with contemporary squalor, he illustrates the disintegration of a coherent tradition, forcing the reader to actively participate in the difficult construction of meaning from cultural ruins.",
                expertHint: "Response B provides a deep, PhD-level analysis. It uses key literary terms correctly ('mosaic', 'juxtaposing', 'construction of meaning') and understands the active role the reader must play, which is a core concept of modernist literature. Response A grasps the basic idea but lacks the necessary analytical depth and terminology."
            },
            {
                prompt: "Critically evaluate the Lucas critique's implications for macroeconomic policy-making, particularly in the context of modern Dynamic Stochastic General Equilibrium (DSGE) models.",
                responseA: "The Lucas critique proved that you can't trust old economic models because people aren't stupid; they change how they act when the government changes a policy. So you can't use past data to predict the future.",
                responseB: "The Lucas critique fundamentally challenged traditional Keynesian macroeconometric models by asserting that policy interventions alter agents' expectations and behaviors, thus invalidating model parameters previously assumed to be structural. Modern DSGE models attempt to address this by building from microfoundations with rational expectations, but they remain susceptible to the critique if their 'deep' parameters regarding preferences and technology are not truly policy-invariant or if agents' expectation formation is misspecified.",
                expertHint: "Response B is the expert answer. It correctly identifies the target of the critique (Keynesian models), the mechanism (agents' expectations and structural parameters), and correctly explains how DSGE models try—and sometimes fail—to solve it. Response A is an oversimplification that misses the key concepts of structural parameters and microfoundations."
            },
            {
                prompt: "Compare and contrast the principles and primary use cases of BLAST (Basic Local Alignment Search Tool) and the Smith-Waterman algorithm for sequence alignment.",
                responseA: "Both are tools for comparing DNA sequences. BLAST is just a faster version of Smith-Waterman that you use for big databases. Smith-Waterman is more accurate for finding the best match but it's too slow for most things.",
                responseB: "The Smith-Waterman algorithm is a dynamic programming method that mathematically guarantees finding the optimal local alignment (highest score), making it the gold standard for sensitivity. Its quadratic time complexity, however, makes it computationally prohibitive for large-scale searches. In contrast, BLAST is a heuristic algorithm that sacrifices this guaranteed optimality for immense speed by finding short, high-scoring word 'seeds' to initiate alignments, making it the standard for rapid database homology searches.",
                expertHint: "Response B is the correct, PhD-level comparison. It correctly identifies the core algorithmic difference (dynamic programming vs. heuristic), the fundamental trade-off (guaranteed optimality vs. speed), and the precise technical reason for BLAST's speed ('word seeds'). Response A is a superficial summary that lacks critical details."
            }
        ];
        let currentAssessmentIndex = 0;


        async function setupProjectsPage() {
            const evaluationContainer = document.getElementById('evaluation-container');
            const projectsListContainer = document.getElementById('projects-list-container');
            
            const userProgressRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/progress`, 'evaluation');
            const docSnap = await getDoc(userProgressRef);

            if (docSnap.exists() && docSnap.data().assessments_passed === true) {
                showProjects();
                return;
            }

            if(evaluationContainer) evaluationContainer.classList.remove('hidden');
            if(projectsListContainer) projectsListContainer.classList.add('hidden');
            renderCurrentAssessment();

            const submitButton = document.getElementById('submit-evaluation-button');
            if(submitButton) {
                submitButton.addEventListener('click', handleAssessmentSubmission);
            }
        }
        
        function renderCurrentAssessment() {
            const assessment = assessments[currentAssessmentIndex];
            const contentEl = document.getElementById('assessment-content');
            
            if(contentEl) {
                contentEl.innerHTML = `
                    <h2 class="text-xl font-bold tracking-tight text-white">Assessment ${currentAssessmentIndex + 1} of ${assessments.length}</h2>
                    <p class="mt-2 text-gray-400">Read the prompt and the two AI responses. Rate which response is better and justify your answer.</p>
                    
                    <div class="mt-6 p-4 bg-gray-700/50 rounded-lg">
                        <h3 class="font-semibold text-teal-300">Prompt:</h3>
                        <p class="mt-1 text-white">"${assessment.prompt}"</p>
                    </div>

                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 bg-gray-900/50 rounded-lg border border-gray-700">
                            <h4 class="font-semibold text-gray-300">Response A</h4>
                            <p class="mt-2 text-gray-300 leading-relaxed">${assessment.responseA}</p>
                        </div>
                        <div class="p-4 bg-gray-900/50 rounded-lg border border-gray-700">
                            <h4 class="font-semibold text-gray-300">Response B</h4>
                            <p class="mt-2 text-gray-300 leading-relaxed">${assessment.responseB}</p>
                        </div>
                    </div>

                    <div class="mt-6">
                        <h3 class="font-semibold text-white">1. Which response is better? (1 = A is much better, 5 = B is much better)</h3>
                        <fieldset class="mt-2">
                            <div class="flex items-center justify-between sm:justify-start sm:space-x-4">
                                <span class="text-sm text-gray-400">A</span>
                                <div class="flex items-center space-x-2">
                                    ${[1,2,3,4,5].map(rating => `
                                    <label for="rating-${rating}" class="relative flex items-center justify-center rounded-full w-10 h-10 bg-gray-700 hover:bg-gray-600 cursor-pointer transition-all duration-200 peer-checked:bg-teal-700">
                                        <input type="radio" name="rating" id="rating-${rating}" value="${rating}" class="peer absolute opacity-0">
                                        <span class="text-white peer-checked:text-white peer-checked:font-bold">${rating}</span>
                                    </label>
                                    `).join('')}
                                </div>
                                <span class="text-sm text-gray-400">B</span>
                            </div>
                        </fieldset>
                    </div>
                    
                    <div class="mt-6">
                        <h3 class="font-semibold text-white">2. Justify your rating:</h3>
                        <textarea id="assessment-justification" rows="4" class="mt-2 block w-full rounded-md border-0 bg-gray-900/80 p-3 text-white placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-teal-500 sm:text-sm" placeholder="Explain your reasoning here..."></textarea>
                    </div>
                `;
            }
        }

        async function handleAssessmentSubmission() {
            const selectedRating = document.querySelector('input[name="rating"]:checked');
            const justificationInput = document.getElementById('assessment-justification');
            const justification = justificationInput ? justificationInput.value.trim() : '';
            const resultEl = document.getElementById('evaluation-result');

            if (!selectedRating) {
                if(resultEl) {
                    resultEl.textContent = 'Please select a rating from 1 to 5.';
                    resultEl.className = 'mt-4 text-center text-sm font-medium text-red-400';
                }
                return;
            }
            if (justification.length < 15) {
                if(resultEl){
                    resultEl.textContent = 'Please provide a more detailed justification (at least 15 characters).';
                    resultEl.className = 'mt-4 text-center text-sm font-medium text-red-400';
                }
                return;
            }

            const submitButton = document.getElementById('submit-evaluation-button');
            const submitBtnText = document.getElementById('submit-btn-text');
            const submitSpinner = document.getElementById('submit-spinner');
            
            if(submitButton) submitButton.disabled = true;
            if(submitBtnText) submitBtnText.textContent = 'Grading...';
            if(submitSpinner) submitSpinner.classList.remove('hidden');
            if(resultEl) resultEl.textContent = '';

            try {
                const aiResult = await gradeWithAI(assessments[currentAssessmentIndex], selectedRating.value, justification);

                if (aiResult.passed) {
                    currentAssessmentIndex++;
                    if (currentAssessmentIndex >= assessments.length) {
                        if(resultEl) {
                            resultEl.textContent = 'Congratulations! You have passed all assessments.';
                            resultEl.className = 'mt-4 text-center text-sm font-medium text-green-400';
                        }
                        const userProgressRef = doc(db, `artifacts/${appId}/users/${currentUser.uid}/progress`, 'evaluation');
                        await setDoc(userProgressRef, { assessments_passed: true });
                        setTimeout(showProjects, 2000);
                    } else {
                         if(resultEl) {
                            resultEl.textContent = 'Correct! Moving to the next assessment.';
                            resultEl.className = 'mt-4 text-center text-sm font-medium text-green-400';
                        }
                        setTimeout(() => {
                            if(resultEl) resultEl.textContent = '';
                            renderCurrentAssessment();
                        }, 1500);
                    }
                } else {
                    if(resultEl){
                        resultEl.innerHTML = `Incorrect. The AI grader provided this feedback: <br/><em class="text-gray-300">"${aiResult.reason}"</em>. Please re-evaluate and try again.`;
                        resultEl.className = 'mt-4 text-center text-sm font-medium text-red-400';
                    }
                }
            } catch (error) {
                console.error('AI Grading Error:', error);
                if(resultEl) {
                    resultEl.textContent = 'An error occurred during grading. Please try again later.';
                    resultEl.className = 'mt-4 text-center text-sm font-medium text-red-400';
                }
            } finally {
                if(submitButton) submitButton.disabled = false;
                if(submitBtnText) submitBtnText.textContent = 'Submit Assessment';
                if(submitSpinner) submitSpinner.classList.add('hidden');
            }
        }


        function showProjects() {
            const evalContainer = document.getElementById('evaluation-container');
            const projectsListContainer = document.getElementById('projects-list-container');
            if(evalContainer) evalContainer.classList.add('hidden');
            if(projectsListContainer) projectsListContainer.classList.remove('hidden');

            const allProjects = [ 
                { name: "Space Camelid" }, { name: "Metro Silo" }, { name: "Valkyrie" }, { name: "Stratus Drake" }, 
                { name: "Rhind Evals" }, { name: "Blueberry Bagels" }, { name: "Cloud Evals" }, { name: "S Knees Man" }, 
                { name: "Mascara Mambo" }, { name: "Glue Sail" }, { name: "Bettascope Rubrics" }, 
                { name: "Multilingual Static Comparison v2" }, { name: "Cloud Evals V3" }, { name: "Cypher Evals V3" }, 
                { name: "Summer Robin" }, { name: "Big Mallet" } 
            ];
            
            const listElement = document.getElementById('projects-list');
            if(listElement) {
                listElement.innerHTML = ''; // Clear previous list
                allProjects.forEach(project => {
                    const li = document.createElement('li');
                    li.className = "col-span-1 flex flex-col rounded-lg bg-gray-700/50 text-center shadow transition-all duration-300 hover:scale-105 hover:border-teal-500 border border-transparent";
                    li.innerHTML = `
                        <div class="flex flex-1 flex-col p-8 justify-center">
                            <h3 class="text-base font-medium text-white">${project.name}</h3>
                        </div>
                    `;
                    listElement.appendChild(li);
                });
            }
        }

        async function gradeWithAI(assessment, userRating, userJustification) {
             const apiKey = ""; // Canvas will provide this
             const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const systemPrompt = `You are an expert AI system that grades a junior evaluator's work.
            You will be given an 'expertHint' that contains the correct reasoning.
            You must evaluate if the junior evaluator's rating and justification align with the expertHint.
            The user's rating is on a scale of 1-5, where 1 means Response A is much better, and 5 means Response B is much better. A 3 is neutral.

            Your response MUST be in JSON format.
            - If the user's logic is sound and aligns with the expert hint, return: {"passed": true, "reason": "The user's reasoning is sound."}
            - If the user's logic is flawed, their rating is incorrect, or they miss the key points from the expert hint, return: {"passed": false, "reason": "A brief, helpful explanation for why they were wrong. For example: 'Your justification missed the key point that Response B was too technical for the audience.'"}
            
            Be strict but fair. The user doesn't have to match the hint word-for-word, but their core reasoning must be correct.
            Do not add any other text outside the JSON object.
            `;
            
            const userQuery = `
                Expert Hint: "${assessment.expertHint}"
                ---
                User's Rating (1-5): ${userRating}
                User's Justification: "${userJustification}"
            `;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                }
            };
            
            let response;
            let attempts = 0;
            const maxAttempts = 5;
            while(attempts < maxAttempts) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) break;
                } catch (error) {
                    console.error(`Attempt ${attempts + 1} failed`, error);
                }
                attempts++;
                await new Promise(res => setTimeout(res, Math.pow(2, attempts) * 1000));
            }
            
            if (!response || !response.ok) {
                 throw new Error('AI service is unavailable after multiple retries.');
            }

            const result = await response.json();
            const jsonString = result.candidates[0].content.parts[0].text;
            return JSON.parse(jsonString);
        }

        async function generateBackgroundImage() {
            const bgImage = document.getElementById('auth-bg-image');
            const apiKey = ""; // Canvas will provide this
             const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const prompt = "A modern, abstract background with flowing teal and dark gray lines, minimalist digital art, cinematic lighting.";

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: { responseModalities: ['IMAGE'] },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API call failed: ${response.status}`);
                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                
                if (base64Data) {
                    bgImage.src = `data:image/png;base64,${base64Data}`;
                } else {
                    throw new Error('No image data in response.');
                }
            } catch (error) {
                console.error("Background image generation failed:", error);
            }
        }

        // --- App Initialization ---
        if(app) {
            setupAuthListeners();
            initAuth();
        }

    </script>
</body>
</html>

